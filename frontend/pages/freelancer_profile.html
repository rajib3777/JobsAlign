{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Freelancer Profile | JobsAlign</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>

<body class="bg-gradient-to-br from-gray-50 to-blue-50 min-h-screen flex flex-col text-gray-800">

  <!-- ‚úÖ Navbar -->
  <header class="bg-white shadow-md sticky top-0 z-50">
    <div class="max-w-7xl mx-auto flex items-center justify-between px-6 py-3">
      <img src="{% static 'images/logo.jpeg' %}" alt="JobsAlign Logo" class="w-24 rounded-full shadow-md">
      <nav class="space-x-6 text-sm font-medium text-gray-700">
        <a href="/frontend/pages/freelancer_dashboard.html" class="hover:text-blue-600">üè† Dashboard</a>
        <a href="#portfolio" class="hover:text-blue-600">üìÅ Portfolio</a>
        <a href="#wallet" class="hover:text-blue-600">üí∞ Wallet</a>
        <a href="#verification" class="hover:text-blue-600">ü™™ Verification</a>
        <button id="logoutBtn" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-md">Logout</button>
      </nav>
    </div>
  </header>

  <!-- ‚úÖ Profile Cover -->
  <section class="relative">
    <img id="coverPhoto" src="{% static 'images/default-cover.jpg' %}" class="w-full h-64 object-cover">
    <div class="absolute inset-0 bg-black/20"></div>

    <div class="absolute bottom-4 left-6 flex items-center space-x-4">
      <img id="profilePhoto" src="{% static 'images/default-avatar.png' %}" class="w-28 h-28 rounded-full border-4 border-white shadow-lg object-cover">
      <div>
        <h1 id="fullName" class="text-3xl font-bold text-white">Freelancer Name</h1>
        <p id="tagline" class="text-gray-200">Your tagline goes here</p>
        <div class="flex items-center text-yellow-400 mt-1">
          <i class="fa fa-star"></i><span id="rating" class="ml-1">0.0</span>
        </div>
      </div>
    </div>
  </section>

  <!-- ‚úÖ Profile Info -->
  <main class="max-w-6xl mx-auto px-6 py-12 space-y-10">
    
    <!-- Basic Info -->
    <div class="bg-white p-6 rounded-xl shadow-md">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-semibold">Profile Information</h2>
        <button id="editProfileBtn" class="text-blue-600 hover:text-blue-700 font-semibold"><i class="fa fa-edit"></i> Edit Profile</button>
      </div>

      <p id="bio" class="text-gray-600 leading-relaxed">Your bio will appear here.</p>
      <div class="mt-3 grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-700">
        <p><strong>Email:</strong> <span id="email"></span></p>
        <p><strong>Location:</strong> <span id="location"></span></p>
        <p><strong>Joined:</strong> <span id="joined"></span></p>
        <p><strong>Status:</strong> <span id="verifiedStatus" class="font-semibold text-yellow-600">Not Verified</span></p>
      </div>
    </div>

    <!-- Skills -->
    <div class="bg-white p-6 rounded-xl shadow-md">
      <h2 class="text-xl font-semibold mb-3">Skills</h2>
      <div id="skillsContainer" class="flex flex-wrap gap-2"></div>
    </div>

    <!-- Portfolio -->
    <div id="portfolio" class="bg-white p-6 rounded-xl shadow-md">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-semibold">Portfolio</h2>
        <button id="uploadPortfolioBtn" class="bg-blue-600 text-white px-3 py-1 rounded-md hover:bg-blue-700"><i class="fa fa-upload"></i> Upload</button>
      </div>
      <div id="portfolioList" class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm"></div>
    </div>

    <!-- Wallet -->
    <div id="wallet" class="bg-white p-6 rounded-xl shadow-md">
      <h2 class="text-xl font-semibold mb-3">Wallet Overview</h2>
      <p><strong>Total Earnings:</strong> $<span id="totalEarnings">0.00</span></p>
      <p><strong>Available Balance:</strong> $<span id="walletBalance">0.00</span></p>
    </div>

    <!-- Verification -->
    <div id="verification" class="bg-white p-6 rounded-xl shadow-md">
      <h2 class="text-xl font-semibold mb-3">Identity Verification</h2>
      <p>Status: <span id="identityStatus" class="font-semibold text-red-600">Not Verified</span></p>
      <button id="uploadKycBtn" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded-md mt-3">Upload Document</button>
    </div>
  </main>

  <!-- ‚úÖ Footer -->
  <footer class="bg-gradient-to-b from-gray-50 to-white border-t border-gray-200 mt-16 text-gray-700">
    <div class="max-w-7xl mx-auto px-6 py-10 grid grid-cols-1 md:grid-cols-4 gap-10 text-sm">
      <div>
        <img src="{% static 'images/logo.jpeg' %}" class="w-32 mb-3 rounded-full shadow-md">
        <p>Empowering freelancers and clients to collaborate, innovate, and grow.</p>
      </div>
      <div>
        <h4 class="text-lg font-semibold mb-3">Platform</h4>
        <ul class="space-y-2">
          <li><a href="/frontend/pages/freelancer_dashboard.html" class="hover:text-blue-600">Dashboard</a></li>
          <li><a href="#portfolio" class="hover:text-blue-600">Portfolio</a></li>
        </ul>
      </div>
      <div>
        <h4 class="text-lg font-semibold mb-3">Resources</h4>
        <ul class="space-y-2">
          <li><a href="#support" class="hover:text-blue-600">Help & Support</a></li>
          <li><a href="#verification" class="hover:text-blue-600">Verification</a></li>
        </ul>
      </div>
      <div>
        <h4 class="text-lg font-semibold mb-3">Connect</h4>
        <p>Email: support@jobsalign.com</p>
        <p>¬© 2025 JobsAlign</p>
      </div>
    </div>
  </footer>

  <!-- ‚úÖ JavaScript -->
  <script>
    const token = localStorage.getItem("access_token");

    async function loadProfile() {
      const resp = await fetch("/api/accounts/profile/", {
        headers: { Authorization: "Bearer " + token },
      });
      const data = await resp.json();
      document.getElementById("fullName").textContent = data.full_name || "Freelancer";
      document.getElementById("email").textContent = data.email || "";
      document.getElementById("tagline").textContent = data.tagline || "";
      document.getElementById("bio").textContent = data.bio || "";
      document.getElementById("rating").textContent = data.rating || "0.0";
      document.getElementById("location").textContent = data.city + ", " + data.country;
      document.getElementById("joined").textContent = new Date(data.date_joined).toLocaleDateString();
      document.getElementById("verifiedStatus").textContent = data.is_verified ? "Verified" : "Not Verified";
      document.getElementById("verifiedStatus").className = data.is_verified ? "text-green-600 font-semibold" : "text-yellow-600 font-semibold";

      if (data.profile_photo) document.getElementById("profilePhoto").src = data.profile_photo;
      if (data.cover_photo) document.getElementById("coverPhoto").src = data.cover_photo;

      const skillsDiv = document.getElementById("skillsContainer");
      skillsDiv.innerHTML = "";
      (data.skills || []).forEach(skill => {
        const span = document.createElement("span");
        span.className = "px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm";
        span.textContent = skill;
        skillsDiv.appendChild(span);
      });
    }

    async function loadWallet() {
      const resp = await fetch("/api/payments/wallet/", {
        headers: { Authorization: "Bearer " + token },
      });
      const data = await resp.json();
      document.getElementById("walletBalance").textContent = data.balance || "0.00";
      document.getElementById("totalEarnings").textContent = data.total_earnings || "0.00";
    }

    async function loadPortfolio() {
      const resp = await fetch("/api/marketplace/portfolio/", {
        headers: { Authorization: "Bearer " + token },
      });
      const list = document.getElementById("portfolioList");
      list.innerHTML = "";
      if (resp.ok) {
        const data = await resp.json();
        data.forEach(item => {
          const div = document.createElement("div");
          div.className = "p-4 border rounded-lg hover:shadow-md";
          div.innerHTML = `<h4 class='font-semibold text-gray-800'>${item.title}</h4><p class='text-gray-600 text-sm mt-1'>${item.description}</p>`;
          list.appendChild(div);
        });
      }
    }

    async function loadVerification() {
      const resp = await fetch("/api/verification/request/me/", {
        headers: { Authorization: "Bearer " + token },
      });
      const data = await resp.json();
      document.getElementById("identityStatus").textContent = data.status || "Not Verified";
      document.getElementById("identityStatus").className = data.status === "verified" ? "text-green-600 font-semibold" : "text-red-600 font-semibold";
    }

    document.getElementById("logoutBtn").addEventListener("click", () => {
      localStorage.clear();
      window.location.href = "/frontend/pages/login.html";
    });

    window.onload = () => {
      loadProfile();
      loadWallet();
      loadPortfolio();
      loadVerification();
    };
  </script>
</body>
</html>
